<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Orders â€” Admin</title>
<link rel="stylesheet" href="/style-v8.0.css">
</head>
<body style="padding:24px;font-family:Inter,system-ui,sans-serif;max-width:1200px;margin:0 auto;">
  <h1 style="margin:0 0 12px;">Orders (Phase 1)</h1>

  <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
    <input id="fEmail"  placeholder="Filter email">
    <input id="fPhone"  placeholder="Filter phone">
    <select id="fStatus">
      <option value="">Any status</option>
      <option>received</option>
      <option>queued</option>
      <option>in_progress</option>
      <option>done</option>
    </select>
    <button id="btnLoad">Load</button>
  </div>

  <table id="tbl" border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">
    <thead>
     <tr>      
      <th>Created</th>
      <th>Order</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Status</th>
      <th>Promo</th>
      <th>Expressions</th>
      <th>File</th>
     </tr>
    </thead>
    <tbody></tbody>
  </table>

<script type="module">
const tbody = document.querySelector('#tbl tbody');

async function load(){
  const p = new URLSearchParams();
  const s  = document.getElementById('fStatus').value;
  const ph = document.getElementById('fPhone').value.trim();
  const em = document.getElementById('fEmail').value.trim();
  if (s)  p.set('status', s);
  if (ph) p.set('phone', ph);
  if (em) p.set('email', em);

  const r = await fetch('/api/orders/list?'+p.toString());
  const j = await r.json();

    const j = await r.json();

// Clear existing rows before adding new ones
tbody.innerHTML = '';

(j.data || []).forEach(o => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${new Date(o.created_at).toLocaleString()}</td>
    <td style="font-family:monospace">${o.id}</td>
    <td>${o.email || ''}</td>
    <td>${o.phone || ''}</td>
    <td>${o.status || ''}</td>
    <td>${o.promo_code || ''}</td>
    <td>${Array.isArray(o.expressions) ? o.expressions.join(', ') : ''}</td>
    <td>${o.file_url ? `<a href="${o.file_url}" target="_blank">view</a>` : ''}</td>
  `;
  tbody.appendChild(tr);
});
}
document.getElementById('btnLoad').addEventListener('click', load);
load();
</script>
</body>
</html>
