<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Start your pack ‚Äî Frankiemoji</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- build: v8.5.0 -->
  <style>
    :root{
      --cream:#FAF3E0;
      --espresso:#2C2419;
      --graphite:#5F5B53;
      --amber:#F0C06C;
      --accent:#D8742B;
      --paper:#F8E8CC;
    }

    /* Hide redundant selected-expression row under the picker */
    .selected-expressions,
    .selected-tags,
    #selected-expressions,
    div[id^="selected-"],
    div[class*="selected-expression"],
    div[class*="selected-expressions"] {
      display: none !important;
    }
    
/* hide duplicate row of selected expressions */
#expr-thumbs {
  display: none !important;
}

    * { box-sizing:border-box; }
    html, body {
      margin:0;
      padding:0;
      background:var(--cream);
      color:var(--espresso);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
    }
    img { display:block; max-width:100%; }
    .container { max-width:1100px; margin:0 auto; padding:0 24px; }

    /* now keep the rest of your existing styles: top bar, marquee, card, rows, form, footer... */
  
</head>
<body>

/* Top bar */
.topbar{position:sticky;top:0;z-index:50;background:rgba(250,243,224,.97);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid #e8dfcc}
.topbar-inner{display:flex;justify-content:center;gap:16px;padding:10px 0}
.nav-btn{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:12px;font-weight:600;cursor:pointer;transition:all .2s}
.nav-btn:hover{background:#b85f22;transform:translateY(-1px)}

/* Hero + marquee */
.hero{text-align:center;padding:32px 0 8px}
.hero h1{margin:0 0 6px;font-size:42px}
.hero-sub{color:var(--graphite);max-width:520px;margin:0 auto}
.marquee-wrap{overflow:hidden;margin:10px 0 22px}
.marquee{display:flex;gap:16px;padding:8px 0;will-change:transform}
.marq-img{width:110px;height:110px;object-fit:contain;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.06);background:#fff;flex:0 0 auto}
@keyframes scrollLeft{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes scrollRight{0%{transform:translateX(-50%)}100%{transform:translateX(0)}}
.track-left{animation:scrollLeft 50s linear infinite}
.track-right{animation:scrollRight 53s linear infinite}

<!-- === Frankiemoji Upload Test Section === -->
<section class="upload-section" style="text-align:center; padding:48px 0;">
  <h2 style="font-family:'DM Serif Display',serif; color:var(--espresso);">
    Send Your Frankiemoji Reference
  </h2>
  <p style="max-width:480px; margin:12px auto; color:var(--graphite);">
    Paste an image URL for now ‚Äî Uploadcare or file picker coming next.
  </p>

  <input id="fileUrl" type="text"
         placeholder="https://example.com/your-image.png"
         style="width:80%; max-width:480px; padding:12px; border-radius:8px; border:1px solid #ccc;" />

  <br /><br />

  <textarea id="note" rows="3"
            placeholder="Add notes for the artist (optional)"
            style="width:80%; max-width:480px; padding:12px; border-radius:8px; border:1px solid #ccc;"></textarea>

  <br /><br />

  <button id="sendBtn"
          style="background:var(--accent); color:white; padding:12px 32px; border:none; border-radius:8px; font-weight:600;">
    Send to Studio
  </button>

  <p id="statusMsg" style="margin-top:16px; font-family:'Inter',sans-serif;"></p>
</section>
<!-- === End Upload Section === -->
    
/* Buttons */
.btn{display:inline-block;border:none;padding:12px 20px;border-radius:12px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;transition:all .2s}
.btn:hover{background:#b85f22;transform:translateY(-1px)}
.btn:active{transform:scale(.97)}
.btn.ghost{background:var(--accent);color:#fff}

/* Card + rows */
.upload-wrap{padding:10px 0 36px}
.card{background:#fff;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
.card.upload{margin:0 auto;max-width:560px;padding:20px}
.row{display:flex;gap:12px;align-items:center;margin:8px 0}
label.small{font-size:12px;color:var(--graphite)}

/* Inputs */
input[type="email"],input[type="tel"]{width:100%;padding:10px;border:1px solid #e6e0cf;border-radius:10px}

/* Expression chips */
.expr-chip{display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;border:1px solid #eadfca;border-radius:999px;background:#fff;font-weight:600;cursor:pointer;font-size:13px;transition:transform .12s, box-shadow .12s, background .12s}
.expr-chip:hover{transform:translateY(-1px)}
.expr-chip.selected{background:#D8742B;color:#fff;border-color:#D8742B;box-shadow:0 2px 8px rgba(0,0,0,.10)}
.expr-thumb{font-size:11px;background:#fff;border:1px solid #eadfca;border-radius:14px;padding:4px 8px;line-height:1;color:#2C2419}

/* Success state */
.success{display:none;text-align:center;padding:24px 12px}

/* Footer */
.site-footer {
  border-top: 1px solid rgba(0,0,0,.04);
  background: #fdf7ee;
  padding: 1.5rem 0 2.5rem;
  text-align: center;
}

.footer-inner {
  width: min(1100px, 92%);
  margin: 0 auto;
}

.footer-inner p {
  font-size: 0.78rem;
  color: rgba(44,36,25,.85);
  margin-bottom: 0.75rem;
}

.footer-links {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
}

.footer-links a {
  text-decoration: none;
  color: rgba(44,36,25,.85);
  font-weight: 500;
  font-size: 0.82rem;
  transition: color 0.25s ease, text-decoration-color 0.25s ease;
}

.footer-links a:hover {
  color: var(--espresso);
  text-decoration: underline;
  text-decoration-color: var(--espresso);
}

@media (max-width: 720px) {
  .footer-links {
    flex-direction: column;
    gap: 0.6rem;
  }
}


@media (max-width:900px){
  .hero h1{font-size:34px}
  .marq-img{width:96px;height:96px}
}
</style>
</head>

<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="container topbar-inner">
      <button class="nav-btn" onclick="location.href='index.html'">Home</button>
      <button class="nav-btn" onclick="location.href='our-story.html'">About</button>
    </div>
  </header>

  <!-- Marquee -->
  <div class="marquee-wrap" aria-hidden="true">
    <div id="mq1" class="marquee track-left"></div>
    <div id="mq2" class="marquee track-right"></div>
  </div>

  <!-- Hero -->
  <section class="hero">
    <div class="container" style="max-width:620px;margin:0 auto;">
      <h1>Start your pack</h1>
      <p class="hero-sub">Upload a selfie, add your email, and we‚Äôll get your <strong>hand-drawn inspired emojis</strong> started.</p>
      <p id="pack-note" style="color:#D8742B;font-weight:600;margin-top:8px;">Selected: ‚Äî</p>
    </div>
  </section>

  <!-- Upload + Expressions card -->
  <section class="upload-wrap">
    <div class="container">
      <form id="uploadForm">
       <div class="card upload">
         
        <!-- Expressions -->
   <div class="row" id="expr-row" style="margin:6px 0 6px;">
     <div id="expr-wrap" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
     <div id="expr-label">
       <strong>Pick your expressions</strong>
       <span id="expr-count" style="font-size:12px;opacity:.7;">0 / 0 selected</span>
     </div>
     </div>

    <div id="expr-chips" style="display:flex;flex-wrap:wrap;gap:8px;">
       <button type="button" class="expression-pill expression-btn">Happy</button>
       <button type="button" class="expression-pill expression-btn">Laughing</button>
       <button type="button" class="expression-pill expression-btn">Wink</button>
       <button type="button" class="expression-pill expression-btn">Big Grin</button>
       <button type="button" class="expression-pill expression-btn">Smirk</button>

       <button type="button" class="expression-pill expression-btn">Thumbs Up</button>
       <button type="button" class="expression-pill expression-btn">Heart Eyes</button>
       <button type="button" class="expression-pill expression-btn">Surprised</button>
       <button type="button" class="expression-pill expression-btn">Face Palm</button>
       <button type="button" class="expression-pill expression-btn">Eye Roll</button>

       <button type="button" class="expression-pill expression-btn">Tired</button>
       <button type="button" class="expression-pill expression-btn">Sad</button>
       <button type="button" class="expression-pill expression-btn">Tearful</button>
       <button type="button" class="expression-pill expression-btn">Angry</button>
       <button type="button" class="expression-pill expression-btn">Mind Blown</button>

       <button type="button" class="expression-pill expression-btn">Cool (Sunglasses)</button>
       <button type="button" class="expression-pill expression-btn">Confident</button>
       <button type="button" class="expression-pill expression-btn">Skeptical</button>
       <button type="button" class="expression-pill expression-btn">Thinking</button>

       <button type="button" class="expression-pill expression-btn">Cheeky Tongue</button>
       <button type="button" class="expression-pill expression-btn">Shy</button>
       <button type="button" class="expression-pill expression-btn">Kiss</button>
       <button type="button" class="expression-pill expression-btn">Celebrating</button>

       <button type="button" class="expression-pill expression-btn">Coffee</button>
       <button type="button" class="expression-pill expression-btn">Prayer Hands</button>
     </div>

  <!-- Hidden field we fill on submit -->
  <input type="hidden" id="expressions" name="expressions" value="">
</div>


        <!-- Email + SMS -->
        <div class="row"><input id="email" type="email" placeholder="Email for delivery  ‚Ä¢  you@example.com" /></div>

        <div class="row">
          <label class="small" style="display:flex;align-items:center;gap:8px;">
            <input type="checkbox" id="sms-optin" style="transform:scale(1.2);" />
            Also text my emoji pack
          </label>
        </div>
        <div class="row" id="sms-row" style="display:none;">
          <input id="phone" type="tel" placeholder="Mobile number (optional)" />
        </div>
        <div class="row">
          <label class="small" style="font-size:11px;color:#5F5B53;">
            By providing your number, you agree to receive a one-time text message from Frankiemoji to deliver your emoji pack.
            Standard message rates may apply.
          </label>
        </div>

       <!-- Uploadcare picker + preview -->
       <div class="row">
       <!-- Uploadcare widget input -->
         <input
       id="u-file"
       type="hidden"
       role="uploadcare-uploader"
       data-clearable=""
       data-tabs="file camera"
       data-images-only="true"
       data-multiple="false"
       data-preview-step="true"
       />

       <!-- Where we store the picked CDN URL from Uploadcare -->
       <input id="fileUrl" type="hidden" />
      </div>

      <div id="u-preview-wrap" style="display:none;margin:10px 0 16px;">
       <img id="u-preview" alt="preview" style="max-width:100%;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);" />
      </div>

        <!-- Actions -->
        <div class="row" style="justify-content:flex-end">
          <a class="btn" href="index.html" style="background:#fff;color:var(--espresso);border:1px solid #eadfca;">Back</a>
          <button class="btn" id="send-btn">Send</button>
        </div>

        <!-- Success -->
        <div class="success" id="success">
          <h2 style="margin:0 0 8px;">All set üéâ</h2>
          <p style="opacity:.85;margin:0 0 12px;">We saved your details and selfie. You‚Äôll hear from us soon.</p>
          <div style="display:flex;gap:10px;justify-content:center;">
            <a class="btn" href="index.html#pricing">Home</a>
            <a class="btn" href="our-story.html">About</a>
          </div>
        </div>
      </div>
    </div>
      </div> <!-- /card upload -->
</form>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
  <div class="footer-inner">
    <p>¬© 2025 Frankiemoji‚Ñ¢ Studios LLC. All Rights Reserved. Born with a Pencil. Evolved with Technology.</p>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</footer>


  <!-- Marquee loader (manifest ‚Üí GitHub ‚Üí hard fallback) -->
  <script>
  (function () {
    const GH = { owner:"martinez-frank", repo:"Emoji1", branch:"main" };
    const EXCLUDE = ["starter","standard","premium"];
    const EXTRA = [/\.ds_store/i, /%20/];

    const q = (s)=>document.querySelector(s);
    const row1 = q("#mq1"), row2 = q("#mq2");
    if (!row1 || !row2) return;

    const isOut = (s)=>{ s=(s||"").toLowerCase(); return EXCLUDE.some(x=>s.includes(x)) || EXTRA.some(rx=>rx.test(s)); };
    const shuffle = (a)=>{ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; };
    const build = (urls)=>{
      const f=document.createDocumentFragment();
      urls.concat(urls).forEach(src=>{
        const im=new Image();
        im.className="marq-img"; im.loading="lazy"; im.decoding="async"; im.alt="Frankiemoji";
        im.src=src; im.onerror=()=>im.remove();
        f.appendChild(im);
      });
      return f;
    };

    async function fromManifest(){
      // support: array OR {stickers:[‚Ä¶]}
      try{
        const res = await fetch("images/manifest.json?cb="+Date.now(), {cache:"no-store"});
        if(!res.ok) throw 0;
        const data = await res.json();
        const list = Array.isArray(data) ? data : (Array.isArray(data.stickers) ? data.stickers : []);
        return list.map(s => String(s).startsWith("images/") ? s : `images/${s}`)
                   .filter(s => /\.(png|jpe?g|webp|gif)$/i.test(s) && !isOut(s));
      }catch{ return []; }
    }

    async function fromGitHub(){
      try{
        const url = `https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/images?ref=${GH.branch}`;
        const r = await fetch(url,{headers:{Accept:"application/vnd.github+json"}});
        if(!r.ok) throw 0;
        const items = await r.json();
        return items.filter(it=>it.type==="file")
                    .filter(it => /\.webp$/i.test(it.name))
                    .filter(it=>!isOut(it.name)&&!isOut(it.path))
                    .map(it=>it.download_url);
      }catch{ return []; }
    }

    (async ()=>{
      let urls = await fromManifest();
      if (!urls.length) {
        const gh = await fromGitHub();
        urls = gh;
      }
      if (!urls.length) {
        urls = ["images/wink.webp","images/laugh.webp","images/smirk.webp","images/ohno.webp"];
      }

      urls = shuffle([...new Set(urls)]);
      row1.appendChild(build(urls));
      row2.appendChild(build([...urls].reverse()));
      row1.style.animationDuration = (50 + Math.random()*2).toFixed(2) + "s";
      row2.style.animationDuration = (53 + Math.random()*2).toFixed(2) + "s";

      // pause on hover
      document.querySelectorAll(".marquee").forEach(m=>{
        m.addEventListener("mouseenter", ()=> m.style.animationPlayState="paused");
        m.addEventListener("mouseleave", ()=> m.style.animationPlayState="running");
      });
    })();
  })();
  </script>

  <!-- Uploadcare -->
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
  <script>window.UPLOADCARE_PUBLIC_KEY='demopublickey';</script>

  <!-- Page logic: pack, expressions, email/sms, upload, send -->
  <script>
  (function(){
    const qs = (s)=>document.querySelector(s);
    const pack = new URLSearchParams(location.search).get('pack') || 'starter';
    const PRETTY = {starter:'Starter', standard:'Standard', premium:'Premium'};
    const MAX_BY_PACK = {starter:3, standard:9, premium:18};

    // pack note
    const note = qs('#pack-note'); if (note) note.textContent = `Selected: ${PRETTY[pack] || 'Starter'} Pack`;

    // prefill email
    let start = {};
    try { start = JSON.parse(localStorage.getItem('franki:start') || '{}'); } catch(_) {}
    if (start.email) qs('#email').value = start.email;

    // SMS toggle
    const optin = qs('#sms-optin'), smsRow = qs('#sms-row');
    if (optin && smsRow){ optin.addEventListener('change', ()=> smsRow.style.display = optin.checked ? 'flex' : 'none'); }

    // expression chips
    const EXPRESSIONS = [
      "Happy","Laughing","Wink","Big Grin","Smirk",
      "Thumbs Up","Heart Eyes","Surprised","Face Palm","Eye Roll",
      "Tired","Sad","Tearful","Angry","Mind Blown",
      "Cool (Sunglasses)","Confident","Skeptical","Thinking","Cheeky Tongue",
      "Shy","Kiss","Celebrating","Coffee","Prayer Hands"
    ];
    const MAX = MAX_BY_PACK[pack] || 3;
    const chipsEl = qs('#expr-chips'), thumbsEl = qs('#expr-thumbs'), hiddenEl = qs('#expressions'), countEl = qs('#expr-count');
    const selected = new Set();
    function render(){
      hiddenEl.value = Array.from(selected).join(',');
      if (countEl) countEl.textContent = `${selected.size} / ${MAX} selected`;
      thumbsEl.innerHTML = '';
      selected.forEach(n=>{ const t=document.createElement('span'); t.className='expr-thumb'; t.textContent=n; thumbsEl.appendChild(t); });
    }
    function toggle(name, chip){
      if (selected.has(name)){ selected.delete(name); chip.classList.remove('selected'); }
      else {
        if (selected.size >= MAX){ chip.style.transform='translateY(-1px) scale(0.98)'; setTimeout(()=>chip.style.transform='',150); return; }
        selected.add(name); chip.classList.add('selected');
      }
      render();
    }
    EXPRESSIONS.forEach(name=>{
      const b=document.createElement('button'); b.type='button'; b.className='expr-chip'; b.textContent=name;
      b.addEventListener('click',()=>toggle(name,b)); chipsEl.appendChild(b);
    });
    render();

   <script>
   // Uploadcare widget + preview
     const widget = uploadcare.Widget('#u-file');

    const fileUrlInput  = document.getElementById('fileUrl');
    const previewWrap   = document.getElementById('u-preview-wrap');
    const previewImg    = document.getElementById('u-preview');

    function showPreview(cdnUrl) {
    if (!previewWrap || !previewImg) return;

    if (!cdnUrl) {
      // Hide preview if nothing selected
      previewWrap.style.display = 'none';
      previewImg.removeAttribute('src');
      return;
    }

    // Nice sized preview
    previewImg.src = cdnUrl + '-/preview/800x800/-/quality/smart/';
    previewWrap.style.display = 'block';
  }

    widget.onChange(function (file) {
    // reset value first
    if (fileUrlInput) fileUrlInput.value = '';

    if (!file) {
      showPreview('');
      return;
    }

    file.done(function (info) {
      if (!info || !info.cdnUrl) return;

      // üîë Save CDN URL for the /api/upload call
      if (fileUrlInput) fileUrlInput.value = info.cdnUrl;

      // Update preview
      showPreview(info.cdnUrl);
    });
  });
</script>

  <!-- === Frankiemoji Upload Script === -->
  <!-- <script>
  const sendBtn = document.getElementById("sendBtn");
  const fileUrlInput = document.getElementById("fileUrl");
  const noteInput = document.getElementById("note");
  const statusMsg = document.getElementById("statusMsg");

  sendBtn.addEventListener("click", async () => {
    const fileUrl = fileUrlInput.value.trim();
    const note = noteInput.value.trim();

    if (!fileUrl) {
      statusMsg.textContent = "Please enter an image URL first.";
      statusMsg.style.color = "#c0392b";
      return;
    }

    statusMsg.textContent = "Sending to Frankiemoji studio‚Ä¶";
    statusMsg.style.color = "#444";

    try {
      const res = await fetch("/api/upload", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          file_url: fileUrl,
          note: note || null
        })
      });
      const data = await res.json();
      console.log('Upload response:', data);

      if (res.ok && data.ok) {
        statusMsg.textContent = "‚úÖ Upload received. We‚Äôll start the emoji magic.";
        statusMsg.style.color = "#2ecc71";
        console.log("Server Response:", data);
      } else {
        statusMsg.textContent = "‚ö†Ô∏è Server responded but with an error.";
        statusMsg.style.color = "#e67e22";
        console.log("Server Error:", data);
      }
    } catch (err) {
      statusMsg.textContent = "‚ùå Could not reach the Frankiemoji API.";
      statusMsg.style.color = "#c0392b";
      console.error(err);
    }
  });
  </script> -->
</script>
<!-- === End Frankiemoji Upload Script === -->
<script>
  // get all expression pills and let user toggle them
  document.querySelectorAll('.expression-pill, .expression-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      btn.classList.toggle('selected');
      updateCount();
    });
  });

  function updateCount() {
    const count = document.querySelectorAll('.expression-pill.selected, .expression-btn.selected').length;
    const counter = document.querySelector('#expr-count');
    if (counter) counter.textContent = count;
  }

  function getSelectedExpressions() {
    const selected = document.querySelectorAll('.expression-pill.selected, .expression-btn.selected');
    return Array.from(selected).map(el => el.textContent.trim());
  }

  async function getSignedUploadUrl() {
    const res = await fetch('/api/get-upload-url', { method: 'POST' });
    const data = await res.json();
    if (!data.ok) throw new Error(data.error || 'Could not get upload URL');
    return data;
  }

  async function uploadFile(file, uploadUrl) {
    const res = await fetch(uploadUrl, {
      method: 'PUT',
      headers: { 'Content-Type': file.type },
      body: file
    });
    if (!res.ok) throw new Error('Upload failed');
  }

document.getElementById('send-btn').addEventListener('click', async () => {
  const packEl = document.getElementById('selected-pack');
  const pack = (packEl?.dataset.pack || 'standard');
  const email = document.getElementById('email').value.trim();
  const expressions = getSelectedExpressions(); // your existing helper
  const fileInput = document.getElementById('file-input');
  const file = fileInput && fileInput.files && fileInput.files[0];

  // basic guards
  if (!file) { alert('Please choose a photo first.'); return; }
  if (!email) { alert('Please enter your email.'); return; }

  // status message (optional)
  const statusMsg = document.getElementById('statusMsg');
  if (statusMsg) { statusMsg.textContent = 'Sending to Frankiemojis‚Ä¶'; }

  try {
    const fd = new FormData();
    fd.append('file', file);                       // <- Blob/File
    fd.append('email', email);
    fd.append('phone', (document.getElementById('phone')?.value || '').trim());
    fd.append('expressions', JSON.stringify(expressions));

    const res = await fetch('/api/upload', {
      method: 'POST',
      headers: { 'x-pack': pack },                 // starter | standard | premium
      body: fd
    });

    const data = await res.json();
    if (!res.ok || !data?.ok) {
      throw new Error(data?.error || `Server returned ${res.status}`);
    }

    // success UI
    if (statusMsg) { statusMsg.textContent = '‚úÖ Upload received. We\'ll start the emoji magic.'; }
    document.getElementById('success')?.style?.setProperty('display','block');

  } catch (err) {
    console.error(err);
    if (statusMsg) { statusMsg.textContent = `‚ùå ${err.message}`; }
    alert('Upload failed.');
  }
});
</script>
<div id="statusMsg" style="margin-top:.75rem"></div>
<!-- PHASE 2 CLEANUP SHIM: disables legacy alerts & handlers -->
<script>
(function(){
  const originalAlert = window.alert;
  window.alert = function(msg){ console.log('[alert suppressed]', msg); };

  const form = document.getElementById('uploadForm');
  if (!form) { console.warn('[cleanup] #uploadForm not found'); return; }

  form.removeAttribute('onsubmit');
  form.setAttribute('action', '');
  form.setAttribute('method', '');

  const killer = function(e){
    if (e.target === form) e.stopImmediatePropagation();
  };
  document.addEventListener('submit', killer, true);

  window.__restoreAlert = () => (window.alert = originalAlert);
  console.log('[cleanup] legacy alerts & submit handlers neutralized');
})();
</script>

<script type="module">
const form   = document.getElementById('uploadForm');
const fileI  = document.getElementById('file');
const emailI = document.getElementById('email');
const phoneI = document.getElementById('phone');
const statusMsg = document.getElementById('statusMsg');

function setStatus(t){ statusMsg.textContent = t; }
function normalizePhone(p){
  const d = (p||'').replace(/\D/g,'');
  return d.length >= 10 ? d : '';
}

if (!form) console.warn('uploadForm not found');

form?.addEventListener('submit', async (e) => {
  e.preventDefault();

  const file = fileI?.files?.[0];
  if(!file){ setStatus('Choose a file'); return; }

  // collect selected expressions if you use pills with data-key
  const selections = [...document.querySelectorAll('.expr.selected')].map(x=>x.dataset.key);

  // guardrails
  if (!file.type.startsWith('image/')) { setStatus('Please upload an image'); return; }
  if (file.size > 10*1024*1024) { setStatus('File too large (>10MB)'); return; }

  const fd = new FormData();
  fd.append('file', file);
  fd.append('email', emailI?.value?.trim() || '');
  fd.append('phone', normalizePhone(phoneI?.value));
  fd.append('expressions', JSON.stringify(selections));

  try {
    setStatus('Uploading file‚Ä¶');
    const res = await fetch('/api/upload', { method: 'POST', body: fd });
    const text = await res.text();           // read raw text for easier debugging
    if (!res.ok) throw new Error(text || 'Upload failed');

    let data = {};
    try { data = JSON.parse(text); } catch { /* ignore */ }

    // show the order id loudly
    const msg = data.order_id ? `Done üéâ Order # ${data.order_id}` : 'Done üéâ';
    setStatus(msg);

    // also pop an alert (until you see it working)
    if (data.order_id) alert('Order ID: ' + data.order_id);

    console.log('Upload response:', data);
  } catch (err) {
    console.error(err);
    setStatus('‚ùå ' + (err.message || 'Upload failed'));
  }
});
</script>
</body>
</html>
